name: Deploy Frontend to EC2

on:
  push:
    branches:
      - main   # ‡∏´‡∏£‡∏∑‡∏≠ branch ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì deploy ‡∏à‡∏£‡∏¥‡∏á

jobs:
  deploy:
    runs-on: self-hosted   # ‡πÉ‡∏ä‡πâ runner ‡∏ö‡∏ô EC2

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Deploy Frontend via Docker Compose
        run: |
          set -e

          echo "üîÑ Pulling latest Frontend code..."
          cd /home/ubuntu/pet-frontend
          git fetch --all
          git reset --hard origin/main

          echo "üåê Building Frontend container..."
          cd /home/ubuntu

          # ‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å .env ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö docker-compose
          export $(cat .env | xargs)

          # ‚úÖ build & up ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ frontend ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
          docker-compose build frontend
          docker-compose up -d frontend

          # üßπ ‡∏•‡πâ‡∏≤‡∏á image ‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ
          docker image prune -f

          echo "‚úÖ Frontend Deployment completed successfully!"